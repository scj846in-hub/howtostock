<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ ìƒëŒ€ë¹„êµ ëŒ€ì‹œë³´ë“œ - ì „ë¬¸ê°€ í†µí•© V5</title>
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --bg: #f8fafc; --border: #e2e8f0; --success: #16a34a; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 10px; font-size: 11px; color: #334155; }
        .container { max-width: 1600px; margin: auto; background: #fff; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .tabs { display: flex; background: #f1f5f9; border-bottom: 1px solid var(--border); overflow-x: auto; }
        .tab-btn { padding: 12px 18px; border: none; cursor: pointer; background: none; font-weight: bold; color: #64748b; white-space: nowrap; }
        .tab-btn.active { background: #fff; color: var(--accent); border-bottom: 3px solid var(--accent); }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        .section { border: 1px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fff; }
        .section-header { font-size: 13px; font-weight: 800; color: var(--primary); margin-bottom: 10px; border-left: 4px solid var(--accent); padding-left: 8px; }
        .grid-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 8px; }
        .input-group { display: flex; flex-direction: column; gap: 3px; }
        label { font-size: 10px; font-weight: 700; color: #475569; }
        input, select { padding: 5px; border: 1px solid var(--border); border-radius: 4px; }
        input[readonly] { background: #f8fafc; color: var(--accent); font-weight: bold; }
        .val-display { background: #eff6ff; padding: 10px; border-radius: 6px; display: flex; justify-content: space-around; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        th { background: #f8fafc; padding: 6px; border: 1px solid var(--border); font-size: 10px; }
        td { padding: 4px; border: 1px solid var(--border); text-align: center; }
        .range-highlight { color: #dc2626; font-weight: 800; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs" id="tabList"></div>
    <div id="panels"></div>
    <div id="compare" class="tab-content">
        <h2 style="text-align:center;">ğŸ† ìµœì¢… íˆ¬ì ìš°ì„ ìˆœìœ„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h2>
        <div id="dashboard" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px;"></div>
    </div>
</div>

<script>
    const stockCount = 5;
    const currentYearMonth = "2026-02"; 

    function init() {
        const tabList = document.getElementById('tabList');
        const panels = document.getElementById('panels');

        for (let i = 1; i <= stockCount; i++) {
            tabList.innerHTML += `<button class="tab-btn" onclick="openTab(event, 'stock${i}')">ì¢…ëª© ${i}</button>`;
            panels.innerHTML += `
                <div id="stock${i}" class="tab-content">
                    <div class="val-display">
                        <span>í˜„ì¬ PER: <span id="dPer_${i}">-</span></span>
                        <span>í˜„ì¬ PBR: <span id="dPbr_${i}">-</span></span>
                        <span>ìë³¸(ìë™): <span id="dEq_${i}">-</span></span>
                        <span>ì‹œì´: <span id="dMc_${i}">-</span></span>
                    </div>

                    <div class="section">
                        <div class="section-header">ğŸ“ ê¸°ë³¸ ì •ë³´ ë° ì‹¤ì  (ìì‚°/ë¶€ì±„ í¬í•¨)</div>
                        <div class="grid-row">
                            <div class="input-group"><label>ì¢…ëª©ëª…</label><input type="text" class="name" value="ì¢…ëª© ${i}"></div>
                            <div class="input-group"><label>ë§¤ìˆ˜í¬ë§ê°€</label><input type="number" class="price" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ì£¼ì‹ìˆ˜</label><input type="number" class="shares" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ë§¤ì¶œì•¡</label><input type="number" class="rev" oninput="syncAll(${i})"></div>
                        </div>
                        <div class="grid-row">
                            <div class="input-group"><label>ì˜ì—…ì´ìµ</label><input type="number" class="op" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ì˜ì—…ì´ìµë¥ </label><input type="text" class="opR" readonly></div>
                            <div class="input-group"><label>ë‹¹ê¸°ìˆœì´ìµ</label><input type="number" class="net" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ìˆœì´ìµë¥ </label><input type="text" class="netR" readonly></div>
                        </div>
                        <div class="grid-row">
                            <div class="input-group"><label>ìì‚°ì´ê³„</label><input type="number" class="assets" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ë¶€ì±„ì´ê³„</label><input type="number" class="debt" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ê³„ì‚°ìë³¸</label><input type="text" class="cEquity" readonly></div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">ğŸ’° Valuation Band ë° ì‹œì¥ ëŒ€ë¹„ ìœ„ì¹˜</div>
                        <div class="grid-row">
                            <div class="input-group"><label>5ê°œë…„ PER ë°´ë“œ(ìƒ/í•˜)</label><div><input type="number" class="perH" style="width:45%" oninput="syncAll(${i})"><input type="number" class="perL" style="width:45%" oninput="syncAll(${i})"></div></div>
                            <div class="input-group"><label>ê²½ìŸì‚¬ í‰ê·  PER</label><input type="number" class="avgPer" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>5ê°œë…„ PBR ë°´ë“œ(ìƒ/í•˜)</label><div><input type="number" class="pbrH" style="width:45%" oninput="syncAll(${i})"><input type="number" class="pbrL" style="width:45%" oninput="syncAll(${i})"></div></div>
                            <div class="input-group"><label>ê²½ìŸì‚¬ í‰ê·  PBR</label><input type="number" class="avgPbr" oninput="syncAll(${i})"></div>
                        </div>
                        <div style="background:#fffbeb; padding:8px; border-radius:4px; font-weight:bold; margin-top:5px; line-height:1.6;">
                            ğŸ“Š [ë°´ë“œ ëŒ€ë¹„ ìœ„ì¹˜]: PER <span class="range-highlight" id="bandPer_${i}">-</span> | PBR <span class="range-highlight" id="bandPbr_${i}">-</span><br>
                            ğŸŒ [ì‹œì¥ í‰ê·  ëŒ€ë¹„]: PER <span class="range-highlight" id="indPer_${i}">-</span> | PBR <span class="range-highlight" id="indPbr_${i}">-</span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">ğŸ†š ê²½ìŸì‚¬ ì„±ì¥ë¥  ë¹„êµ (í†µí•© ìˆœìœ„ ë„ì¶œ)</div>
                        <table>
                            <thead><tr><th>ê²½ìŸì‚¬ëª…</th><th>ë§¤ì¶œì„±ì¥(%)</th><th>ì˜ì—…ìµì„±ì¥(%)</th><th>ìˆœì´ìµì„±ì¥(%)</th></tr></thead>
                            <tbody>
                                <tr style="background:#f0f9ff"><td><input type="text" value="ë‚´ ì¢…ëª©" readonly></td><td><input type="number" class="myRevG"></td><td><input type="number" class="myOpG"></td><td><input type="number" class="myNetG"></td></tr>
                                ${Array(4).fill().map(() => `<tr><td><input type="text" class="cName" placeholder="ê²½ìŸì‚¬ëª…"></td><td><input type="number" class="cRevG"></td><td><input type="number" class="cOpG"></td><td><input type="number" class="cNetG"></td></tr>`).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div class="section">
                        <div class="section-header">ğŸ“ˆ ì°¨íŠ¸ ë¶„ì„ (ëŒíŒŒ ëŒ€ê¸ˆ ë¹„ì¤‘)</div>
                        <div class="grid-row">
                            <div class="input-group"><label>ì´í‰ì„  ì •ë°°ì—´</label><select class="ma"><option value="Y">Y</option><option value="N">N</option></select></div>
                            <div class="input-group"><label>ëŒíŒŒ ê±°ë˜ëŒ€ê¸ˆ</label><input type="number" class="breakVol" oninput="syncAll(${i})"></div>
                            <div class="input-group"><label>ëŒ€ê¸ˆ/ì‹œì´ ë¹„ì¤‘</label><input type="text" class="volRatio" readonly></div>
                            <div class="input-group"><label>í˜„ì¬ê°€ > ëŒíŒŒ ì‹œê°€</label><select class="pricePos"><option value="Y">Y</option><option value="N">N</option></select></div>
                        </div>
                        <div class="grid-row">
                            <div class="input-group"><label>RSI/MACD ê³¼ë§¤ë„ íƒˆì¶œ(1-5)</label><input type="number" class="osc" min="1" max="5" value="3"></div>
                            <div class="input-group"><label>OBV ìœ ì§€(1-5)</label><input type="number" class="obv" min="1" max="5" value="3"></div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">ğŸ’§ ìˆ˜ê¸‰ ë° í…Œë§ˆ ë¶„ì„</div>
                        <div class="grid-row">
                            <div class="input-group"><label>ì£¼ìš”ìˆ˜ê¸‰ ìœ ì…(ì—°ê¸°ê¸ˆ ë“±)</label><select class="supply"><option value="Y">Y</option><option value="N">N</option></select></div>
                            <div class="input-group"><label>í•˜ë½ ì‹œ ìˆ˜ê¸‰ì£¼ì²´ ì”ì¡´</label><select class="supplyH"><option value="Y">Y</option><option value="N">N</option></select></div>
                            <div class="input-group"><label>í…Œë§ˆ ìƒì¡´ë„(1-5)</label><input type="number" class="tLive" min="1" max="5" value="3"></div>
                            <div class="input-group"><label>í…Œë§ˆ ëŒ€ì¥ì£¼(1-5)</label><input type="number" class="tLead" min="1" max="5" value="1"></div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">ğŸ”” ê³µì‹œ ê°€ì¤‘í‰ê·  ë¶„ì„ (ì‹œì  ê°€ì¤‘ì¹˜ ë°˜ì˜)</div>
                        <table id="eTable_${i}">
                            <thead><tr><th>ì¢…ë¥˜</th><th>ì‹œì (ë…„/ì›”)</th><th>ê¸°ì¤€ê°€</th><th>ì´ê¸ˆì•¡</th><th>ë³´ì • ê°€ì¤‘ì¹˜</th></tr></thead>
                            <tbody>
                                ${Array(5).fill().map(() => `<tr>
                                    <td><select><option>ì¥ë‚´ë§¤ìˆ˜</option><option>ìì‚¬ì£¼</option><option>CB</option><option>ìœ ì¦</option></select></td>
                                    <td><input type="month" class="eDate" oninput="syncAll(${i})"></td>
                                    <td><input type="number" class="eP" oninput="syncAll(${i})"></td>
                                    <td><input type="number" class="eA" oninput="syncAll(${i})"></td>
                                    <td><input type="text" class="eW" readonly></td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                        <div style="margin-top:5px; text-align:right; font-weight:bold;">ê°€ì¤‘í‰ê·  ë³´ì •ë‹¨ê°€: <span id="eAvg_${i}">0</span></div>
                    </div>
                </div>
            `;
        }
        tabList.innerHTML += `<button class="tab-btn" style="background:var(--accent); color:#fff;" onclick="runEval()">ğŸ“Š ì¢…í•© ìƒëŒ€ë¹„êµ ì‹¤í–‰</button>`;
        openTab(null, 'stock1');
    }

    function syncAll(i) {
        const p = document.getElementById(`stock${i}`);
        const price = parseFloat(p.querySelector('.price').value) || 0;
        const mc = price * (parseFloat(p.querySelector('.shares').value) || 0);
        
        const rev = parseFloat(p.querySelector('.rev').value) || 0;
        const net = parseFloat(p.querySelector('.net').value) || 0;
        const assets = parseFloat(p.querySelector('.assets').value) || 0;
        const debt = parseFloat(p.querySelector('.debt').value) || 0;
        const equity = assets - debt;
        
        if(rev > 0) {
            p.querySelector('.opR').value = ((parseFloat(p.querySelector('.op').value)||0)/rev*100).toFixed(1) + "%";
            p.querySelector('.netR').value = (net/rev*100).toFixed(1) + "%";
        }
        p.querySelector('.cEquity').value = equity.toLocaleString();
        
        const curPer = net !== 0 ? mc / net : 0;
        const curPbr = equity !== 0 ? mc / equity : 0;
        
        document.getElementById(`dPer_${i}`).innerText = curPer.toFixed(2);
        document.getElementById(`dPbr_${i}`).innerText = curPbr.toFixed(2);
        document.getElementById(`dEq_${i}`).innerText = equity.toLocaleString();
        document.getElementById(`dMc_${i}`).innerText = mc.toLocaleString();

        const bVol = parseFloat(p.querySelector('.breakVol').value) || 0;
        if(mc > 0) p.querySelector('.volRatio').value = ((bVol/mc)*100).toFixed(2) + "%";

        const calcPos = (cur, target, id) => { if (target > 0 && cur > 0) document.getElementById(id).innerText = ((cur / target) * 100).toFixed(1) + "%"; };
        calcPos(curPer, (parseFloat(p.querySelector('.perH').value) + parseFloat(p.querySelector('.perL').value))/2, `bandPer_${i}`);
        calcPos(curPbr, (parseFloat(p.querySelector('.pbrH').value) + parseFloat(p.querySelector('.pbrL').value))/2, `bandPbr_${i}`);
        calcPos(curPer, parseFloat(p.querySelector('.avgPer').value), `indPer_${i}`);
        calcPos(curPbr, parseFloat(p.querySelector('.avgPbr').value), `indPbr_${i}`);

        let sumWP = 0, sumA = 0;
        p.querySelectorAll(`#eTable_${i} tbody tr`).forEach(r => {
            const ep = parseFloat(r.querySelector('.eP').value) || 0;
            const ea = parseFloat(r.querySelector('.eA').value) || 0;
            const dateVal = r.querySelector('.eDate').value;
            if (ea > 0 && dateVal) {
                const diffMonths = (2026 - parseInt(dateVal.split('-')[0])) * 12 + (2 - parseInt(dateVal.split('-')[1]));
                const timeWeight = Math.max(0.5, 1.5 - (diffMonths / 24)); 
                r.querySelector('.eW').value = ((ea/mc)*100*timeWeight).toFixed(1) + '%';
                sumWP += (ep * ea * timeWeight); sumA += (ea * timeWeight);
            }
        });
        document.getElementById(`eAvg_${i}`).innerText = sumA > 0 ? Math.round(sumWP/sumA).toLocaleString() : '0';
    }

    function openTab(e, id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(e) e.currentTarget.classList.add('active');
    }

    function runEval() {
        let res = [];
        for (let i = 1; i <= stockCount; i++) {
            const p = document.getElementById(`stock${i}`);
            
            const getRank = (myVal, cSelector) => {
                const vals = [myVal, ...Array.from(p.querySelectorAll(cSelector)).map(el => parseFloat(el.value)|| -999)];
                return vals.sort((a,b)=>b-a).indexOf(myVal) + 1;
            };
            const rRank = getRank(parseFloat(p.querySelector('.myRevG').value)||0, '.cRevG');
            const oRank = getRank(parseFloat(p.querySelector('.myOpG').value)||0, '.cOpG');
            const nRank = getRank(parseFloat(p.querySelector('.myNetG').value)||0, '.cNetG');
            const avgGrowthRank = (rRank + oRank + nRank) / 3;

            let score = (6 - avgGrowthRank) * 10;
            score += (parseInt(p.querySelector('.osc').value)||0) + (parseInt(p.querySelector('.obv').value)||0);
            score += (parseInt(p.querySelector('.tLive').value)||0) * 5 + (parseInt(p.querySelector('.tLead').value)||0) * 5;
            
            const vRatio = parseFloat(p.querySelector('.volRatio').value.replace('%','')) || 0;
            if(vRatio > 5) score += 10;

            const checks = ['.ma', '.pricePos', '.supply', '.supplyH'];
            checks.forEach(sel => { if(p.querySelector(sel).value === 'Y') score += 5; });

            res.push({ name: p.querySelector('.name').value, score, avgRank: avgGrowthRank, indPer: document.getElementById(`indPer_${i}`).innerText });
        }
        res.sort((a,b)=>b.score - a.score);
        document.getElementById('dashboard').innerHTML = res.map((r, idx) => `
            <div style="padding:15px; border:1px solid #e2e8f0; border-radius:10px; background:${idx===0?'#f0f9ff':'#fff'}">
                <h3>#${idx+1} ${r.name}</h3>
                <div style="font-size:24px; font-weight:bold; color:var(--accent);">${r.score.toFixed(1)}ì </div>
                <div style="margin-top:10px; line-height:1.7;">
                    â€¢ 3ëŒ€ ì„±ì¥ì§€í‘œ í†µí•© ìˆœìœ„: <strong>${r.avgRank.toFixed(1)}ìœ„</strong><br>
                    â€¢ ì‚°ì—… í‰ê·  ëŒ€ë¹„ Valuation: ${r.indPer}<br>
                    â€¢ ë§¤ìˆ˜ íŒë‹¨: ${r.score > 75 ? 'ğŸš€ ìµœìš°ì„  ë§¤ìˆ˜' : (r.score > 55 ? 'âš–ï¸ ë¹„ì¤‘ ì¡°ì ˆ' : 'ğŸ’¤ ê´€ë§')}
                </div>
            </div>
        `).join('');
        openTab(null, 'compare');
    }

    window.onload = init;
</script>
</body>
</html>
