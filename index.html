<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ ìƒëŒ€ë¹„êµ ëŒ€ì‹œë³´ë“œ - ì „ë¬¸ê°€ V28</title>
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --bg: #f8fafc; --border: #e2e8f0; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; --indigo: #6366f1; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 10px; font-size: 11px; color: #334155; }
        .container { max-width: 1750px; margin: auto; background: #fff; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .header-bar { display: flex; background: #f1f5f9; border-bottom: 1px solid var(--border); align-items: center; padding: 0 15px; flex-wrap: wrap; }
        .tabs-container { display: flex; overflow-x: auto; flex-grow: 1; align-items: center; }
        .tab-btn { padding: 12px 18px; border: none; cursor: pointer; background: none; font-weight: bold; color: #64748b; white-space: nowrap; border-bottom: 3px solid transparent; }
        .tab-btn.active { background: #fff; color: var(--accent); border-bottom: 3px solid var(--accent); }
        .action-btns { display: flex; gap: 8px; padding: 10px 0; }
        .btn { padding: 8px 14px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; font-size: 10.5px; color: #fff; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn-add { background: #1e293b; } .btn-save { background: var(--success); } .btn-report { background: var(--indigo); }
        .tab-content { display: none; padding: 20px; } .tab-content.active { display: block; }
        .section { border: 1px solid var(--border); padding: 18px; border-radius: 8px; margin-bottom: 18px; background: #fff; }
        .section-header { font-size: 13px; font-weight: 800; color: var(--primary); margin-bottom: 12px; border-left: 4px solid var(--accent); padding-left: 10px; display: flex; justify-content: space-between; align-items: center; }
        .grid-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin-bottom: 10px; }
        .input-group { display: flex; flex-direction: column; gap: 4px; }
        label { font-size: 10px; font-weight: 700; color: #475569; }
        input, select { padding: 6px; border: 1px solid var(--border); border-radius: 4px; font-size: 11px; outline: none; width: 100%; box-sizing: border-box; }
        input[readonly] { background: #f8fafc; cursor: not-allowed; color: var(--accent); font-weight: bold; }
        .val-display { background: #eff6ff; padding: 15px; border-radius: 8px; display: flex; justify-content: space-around; font-weight: bold; color: var(--accent); margin-bottom: 20px; border: 1px solid #dbeafe; font-size: 12.5px; }
        .summary-box { background: #fffbeb; border: 1px solid #fde68a; padding: 12px; border-radius: 6px; margin-top: 10px; font-weight: bold; color: #92400e; font-size: 11px; line-height: 1.5; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 10.5px; }
        th { background: #f1f5f9; padding: 8px; border: 1px solid var(--border); color: #475569; }
        td { padding: 5px; border: 1px solid var(--border); text-align: center; }
        .table-input { border: none; text-align: center; width: 100%; background: transparent; }
        #report-section { display: none; padding: 30px; background: #fff; }
        .rank-card { border: 2px solid var(--accent); border-radius: 12px; padding: 20px; margin-bottom: 20px; background: #f0f7ff; }
        .analyst-text { line-height: 1.8; font-size: 12px; color: #334155; white-space: pre-wrap; margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid var(--indigo); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bar">
        <div class="tabs-container" id="tabList"></div>
        <div class="action-btns">
            <button class="btn btn-add" onclick="addNewStock()">+ ì¢…ëª© ì¶”ê°€</button>
            <button class="btn btn-save" onclick="manualSave()">ğŸ’¾ ë°ì´í„° ì €ì¥</button>
            <button class="btn btn-report" onclick="generateReport()">ğŸ“Š ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±</button>
        </div>
    </div>
    
    <div id="panels"></div>

    <div id="report-section">
        <div id="report-content"></div>
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn btn-add" onclick="closeReport()">ë¶„ì„ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>
</div>

<script>
    let stockIdCounter = 0;
    const STORAGE_KEY = 'STOCK_PRO_V28_VALUATION';

    function addNewStock(savedName = null) {
        stockIdCounter++;
        const id = `stock_${stockIdCounter}`;
        const name = savedName || `ì¢…ëª© ${stockIdCounter}`;
        
        const btn = document.createElement('button');
        btn.id = `btn_${id}`; btn.className = 'tab-btn'; btn.innerText = name;
        btn.onclick = (e) => openTab(e, id);
        document.getElementById('tabList').appendChild(btn);

        const panel = document.createElement('div');
        panel.id = id; panel.className = 'tab-content';
        panel.innerHTML = `
            <div class="val-display">
                <span>í¬ë§ê°€ PER: <span id="dPer_${id}">-</span></span>
                <span>í¬ë§ê°€ PBR: <span id="dPbr_${id}">-</span></span>
                <span>ì‹œê°€ì´ì•¡: <span id="dMc_${id}">-</span>ì–µ</span>
                <span>ìë³¸ì´ê³„: <span id="dCap_${id}">-</span>ì–µ</span>
            </div>

            <div class="section">
                <div class="section-header">ğŸ“ ê¸°ë³¸ ì •ë³´ ë° ì‹¤ì /ì•ˆì •ì„± ì§€í‘œ <button class="btn" style="background:var(--danger); padding:2px 8px;" onclick="deleteStock('${id}')">ì‚­ì œ</button></div>
                <div class="grid-row">
                    <div class="input-group"><label>ì¢…ëª©ëª…</label><input type="text" class="stock-name" value="${name}" oninput="updateTabName('${id}', this.value)"></div>
                    <div class="input-group"><label>ë§¤ìˆ˜í¬ë§ê°€</label><input type="number" class="price" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ì£¼ì‹ìˆ˜</label><input type="number" class="shares" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ë§¤ì¶œì•¡(ì–µ)</label><input type="number" class="rev" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ì˜ì—…ì´ìµ(ì–µ)</label><input type="number" class="op" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ìˆœì´ìµ(ì–µ)</label><input type="number" class="net" oninput="syncAll('${id}')"></div>
                </div>
                <div class="grid-row" style="margin-top:10px; padding-top:10px; border-top:1px dashed #eee;">
                    <div class="input-group"><label>ìì‚°ì´ê³„(ì–µ)</label><input type="number" class="assets" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ë¶€ì±„ì´ê³„(ì–µ)</label><input type="number" class="debt" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ìë³¸ì´ê³„(ìë™)</label><input type="number" class="capital" readonly></div>
                    <div class="input-group"><label>ìœ ë™ë¹„ìœ¨(%)</label><input type="number" class="curRatio" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ë¶€ì±„ë¹„ìœ¨(%)</label><input type="number" class="debtRatio" oninput="syncAll('${id}')"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">ğŸ’° Valuation Band ë° ê²½ìŸì‚¬ ìƒì„¸ ë¹„êµ</div>
                <div class="grid-row">
                    <div class="input-group"><label>PER ìƒë‹¨</label><input type="number" class="val-perH" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>PER í•˜ë‹¨</label><input type="number" class="val-perL" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>PBR ìƒë‹¨</label><input type="number" class="val-pbrH" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>PBR í•˜ë‹¨</label><input type="number" class="val-pbrL" oninput="syncAll('${id}')"></div>
                </div>
                
                <div id="valSummary_${id}" class="summary-box">ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ ë°¸ë¥˜ì—ì´ì…˜ ìš”ì•½ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>

                <div style="overflow-x:auto;">
                    <table class="compTable">
                        <thead>
                            <tr>
                                <th rowspan="2">ê¸°ì—…ëª…</th><th colspan="3">5ê°œë…„ ì„±ì¥ë¥ (%)</th><th colspan="2">ìˆ˜ìµì„±(%)</th><th colspan="2">ì•ˆì •ì„±(%)</th><th colspan="2">ë©€í‹°í”Œ</th><th rowspan="2">ê´€ë¦¬</th>
                            </tr>
                            <tr><th>ë§¤ì¶œ</th><th>ì˜ì—…ìµ</th><th>ìˆœì´ìµ</th><th>ì˜ì—…ìµë¥ </th><th>ìˆœìµë¥ </th><th>ìœ ë™ë¹„</th><th>ë¶€ì±„ë¹„</th><th>PER</th><th>PBR</th></tr>
                        </thead>
                        <tbody>
                            <tr style="background:#f0f9ff">
                                <td>ë‚´ì¢…ëª©</td>
                                <td><input type="number" class="myRevG table-input"></td><td><input type="number" class="myOpG table-input"></td><td><input type="number" class="myNetG table-input"></td>
                                <td><input type="number" class="myOpM table-input" readonly></td><td><input type="number" class="myNetM table-input" readonly></td>
                                <td><input type="number" class="myCurR table-input" readonly></td><td><input type="number" class="myDebtR table-input" readonly></td>
                                <td><input type="number" class="myPerVal table-input" readonly></td><td><input type="number" class="myPbrVal table-input" readonly></td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button class="btn" style="background:var(--primary); margin-top:8px; width:100%; justify-content:center;" onclick="addCompRow('${id}')">+ ê²½ìŸì‚¬ ì¶”ê°€</button>
            </div>

            <div class="section">
                <div class="section-header">ğŸ“Š ìˆ˜ê¸‰ ë° ì°¨íŠ¸ ê¸°ìˆ ì  ë¶„ì„</div>
                <div class="grid-row">
                    <div class="input-group"><label>ë§¤ì§‘ë´‰(ìµœê·¼3ë‹¬)</label><select class="tech-candles"><option value="1">1ê°œ</option><option value="2">2ê°œ</option><option value="3">3ê°œ</option><option value="4">4ê°œ</option><option value="5">5ê°œ ì´ìƒ</option></select></div>
                    <div class="input-group"><label>MACD/RSI ì ìˆ˜(1-5)</label><input type="number" class="tech-rsi" min="1" max="5"></div>
                    <div class="input-group"><label>OBV ìƒíƒœ</label><select class="tech-obv"><option value="5">ê¸°ì¤€ì„  ìœ ì§€</option><option value="1">ê¸°ì¤€ì„  ì´íƒˆ</option></select></div>
                    <div class="input-group"><label>ì£¼ìš”ìˆ˜ê¸‰ ì§„ì…(ê°œ)</label><input type="number" class="tech-inst"></div>
                    <div class="input-group"><label>ì´íƒˆì—¬ë¶€</label><select class="tech-exit"><option value="Y">N (ìœ ì§€)</option><option value="N">Y (íƒˆì¶œ)</option></select></div>
                </div>
                <div class="grid-row">
                    <div class="input-group"><label>ëŒíŒŒ ê±°ë˜ëŒ€ê¸ˆ(ì–µ)</label><input type="number" class="breakVol" oninput="syncAll('${id}')"></div>
                    <div class="input-group"><label>ì‹œì´ ëŒ€ë¹„ ë¹„ì¤‘</label><input type="text" class="volRatio" readonly></div>
                    <div class="input-group"><label>ì´í‰ì„  ìƒíƒœ</label><select class="tech-ma"><option value="5">ì •ë°°ì—´</option><option value="1">ì—­ë°°ì—´</option><option value="3">ìˆ˜ë ´ì¤‘</option></select></div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">ğŸ”” ì£¼ê°€ ê´€ë ¨ ê³µì‹œ ì •ë³´</div>
                <table class="eTable">
                    <thead><tr><th>ê³µì‹œ ì¢…ë¥˜</th><th>ë°œìƒì›”</th><th>ê¸°ì¤€ê°€</th><th>ê¸ˆì•¡(ì–µ)</th><th>ì‹œì´ë¹„ì¤‘</th><th>ì‚­ì œ</th></tr></thead>
                    <tbody></tbody>
                </table>
                <button class="btn" style="background:var(--success); margin-top:8px; width:100%; justify-content:center;" onclick="addEventRow('${id}')">+ ê³µì‹œ í•­ëª© ì¶”ê°€</button>
            </div>
        `;
        document.getElementById('panels').appendChild(panel);
        addEventRow(id);
        openTab(null, id);
    }

    function addCompRow(id) {
        const tbody = document.getElementById(id).querySelector('.compTable tbody');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="text" class="table-input" placeholder="ê¸°ì—…ëª…"></td>
            <td><input type="number" class="table-input"></td><td><input type="number" class="table-input"></td><td><input type="number" class="table-input"></td>
            <td><input type="number" class="table-input"></td><td><input type="number" class="table-input"></td>
            <td><input type="number" class="table-input"></td><td><input type="number" class="table-input"></td>
            <td><input type="number" class="table-input cPer" oninput="syncAll('${id}')"></td>
            <td><input type="number" class="table-input cPbr" oninput="syncAll('${id}')"></td>
            <td><button class="btn" style="background:var(--danger); padding:2px 5px;" onclick="this.closest('tr').remove(); syncAll('${id}')">X</button></td>
        `;
        tbody.appendChild(tr);
    }

    function addEventRow(id) {
        const tbody = document.getElementById(id).querySelector('.eTable tbody');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><select class="eType"><option value="5">ì¥ë‚´ë§¤ìˆ˜</option><option value="4">ìœ ìƒì¦ì(3ì)</option><option value="1">ìœ ìƒì¦ì(ì¼ë°˜)</option><option value="3">CB/BW</option><option value="4">ìì‚¬ì£¼ ë§¤ì…</option><option value="3">ì¦ì—¬/ìƒì†</option></select></td>
            <td><input type="month" class="table-input"></td><td><input type="number" class="table-input eP" oninput="syncAll('${id}')"></td><td><input type="number" class="table-input eA" oninput="syncAll('${id}')"></td>
            <td><input type="text" class="table-input eR" readonly></td><td><button class="btn" style="background:var(--danger); padding:2px 5px;" onclick="this.closest('tr').remove()">X</button></td>
        `;
        tbody.appendChild(tr);
    }

    function syncAll(id) {
        const p = document.getElementById(id);
        const price = parseFloat(p.querySelector('.price').value) || 0;
        const shares = parseFloat(p.querySelector('.shares').value) || 0;
        const mc = (price * shares) / 100000000;
        const rev = parseFloat(p.querySelector('.rev').value) || 0;
        const op = parseFloat(p.querySelector('.op').value) || 0;
        const net = parseFloat(p.querySelector('.net').value) || 0;
        const assets = parseFloat(p.querySelector('.assets').value) || 0;
        const debt = parseFloat(p.querySelector('.debt').value) || 0;
        const capital = assets - debt;

        const curPer = net ? (mc/net).toFixed(2) : 0;
        const curPbr = capital ? (mc/capital).toFixed(2) : 0;

        p.querySelector('.capital').value = capital;
        p.querySelector('.myOpM').value = rev > 0 ? ((op / rev) * 100).toFixed(1) : 0;
        p.querySelector('.myNetM').value = rev > 0 ? ((net / rev) * 100).toFixed(1) : 0;
        p.querySelector('.myCurR').value = p.querySelector('.curRatio').value || 0;
        p.querySelector('.myDebtR').value = p.querySelector('.debtRatio').value || 0;
        p.querySelector('.myPerVal').value = curPer;
        p.querySelector('.myPbrVal').value = curPbr;

        document.getElementById(`dPer_${id}`).innerText = curPer || "-";
        document.getElementById(`dPbr_${id}`).innerText = curPbr || "-";
        document.getElementById(`dMc_${id}`).innerText = Math.round(mc).toLocaleString();
        document.getElementById(`dCap_${id}`).innerText = Math.round(capital).toLocaleString();

        const breakVol = parseFloat(p.querySelector('.breakVol').value) || 0;
        if(mc > 0) p.querySelector('.volRatio').value = ((breakVol / mc) * 100).toFixed(2) + " %";

        p.querySelectorAll('.eTable tbody tr').forEach(row => {
            const amount = parseFloat(row.querySelector('.eA').value) || 0;
            if(mc > 0 && amount > 0) row.querySelector('.eR').value = ((amount / mc) * 100).toFixed(2) + " %";
        });

        // ë°¸ë¥˜ì—ì´ì…˜ ìš”ì•½ ë¡œì§
        updateValSummary(id, curPer, curPbr);
    }

    function updateValSummary(id, curPer, curPbr) {
        const p = document.getElementById(id);
        const perH = parseFloat(p.querySelector('.val-perH').value) || 0;
        const perL = parseFloat(p.querySelector('.val-perL').value) || 0;
        
        let compPers = [];
        p.querySelectorAll('.cPer').forEach(el => { if(el.value) compPers.push(parseFloat(el.value)); });
        const avgCompPer = compPers.length ? (compPers.reduce((a,b)=>a+b,0) / compPers.length).toFixed(2) : 0;

        let summary = "";
        if(perH && perL) {
            const pos = ((curPer - perL) / (perH - perL) * 100).toFixed(1);
            summary += `ğŸ“Œ <b>ë°´ë“œ ìœ„ì¹˜:</b> í˜„ì¬ PER ${curPer}ì€ ì„¤ì • ë°´ë“œì˜ <b>${pos}%</b> ì§€ì ì— ìœ„ì¹˜í•©ë‹ˆë‹¤. `;
            summary += pos < 30 ? "(ì €í‰ê°€ êµ¬ê°„) " : pos > 70 ? "(ê³ í‰ê°€ ì£¼ì˜) " : "(ì ì • êµ¬ê°„) ";
        }
        if(avgCompPer > 0) {
            const diff = (((curPer / avgCompPer) - 1) * 100).toFixed(1);
            summary += `<br>ğŸ“Š <b>ê²½ìŸì‚¬ ë¹„êµ:</b> í”¼ì–´ í‰ê·  PER(${avgCompPer}) ëŒ€ë¹„ <b>${diff > 0 ? diff+'% í• ì¦' : Math.abs(diff)+'% í• ì¸'}</b> ìƒíƒœì…ë‹ˆë‹¤.`;
        }
        
        p.querySelector(`#valSummary_${id}`).innerHTML = summary || "ë°´ë“œ ì •ë³´ì™€ ê²½ìŸì‚¬ PERì„ ì…ë ¥í•˜ë©´ ìƒì„¸ ìš”ì•½ì´ í‘œì‹œë©ë‹ˆë‹¤.";
    }

    function openTab(e, id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const btn = document.getElementById(`btn_${id}`);
        if(btn) btn.classList.add('active');
        closeReport();
    }

    function generateReport() {
        const panels = document.querySelectorAll('.tab-content');
        if (panels.length < 1) return alert("ë¶„ì„í•  ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");

        let stockScores = [];
        panels.forEach(p => {
            const id = p.id;
            const name = p.querySelector('.stock-name').value;
            const opM = parseFloat(p.querySelector('.myOpM').value) || 0;
            const curR = parseFloat(p.querySelector('.myCurR').value) || 0;
            const curPer = parseFloat(p.querySelector('.myPerVal').value) || 999;
            const candles = parseInt(p.querySelector('.tech-candles').value) || 0;
            
            let eventScore = 0;
            p.querySelectorAll('.eTable tbody tr').forEach(row => {
                const ratio = parseFloat(row.querySelector('.eR').value) || 0;
                eventScore += (ratio * 5);
            });

            // ì ìˆ˜ ë¡œì§: ì €PER ê°€ì‚°ì  ì¶”ê°€
            let totalScore = (opM * 1.2) + (curR / 50) + (candles * 5) + eventScore;
            if(curPer < 10 && curPer > 0) totalScore += 15;

            stockScores.push({ name, score: totalScore, opM, curR, candles, curPer });
        });

        stockScores.sort((a, b) => b.score - a.score);
        const top = stockScores[0];

        let html = `
            <div class="rank-card">
                <h2 style="color:var(--accent)">ğŸ† ìµœì¢… ì¶”ì²œ ì¢…ëª©: ${top.name}</h2>
                <div class="analyst-text">
<strong>[AI ì• ë„ë¦¬ìŠ¤íŠ¸ ë°¸ë¥˜ì—ì´ì…˜ ë¦¬í¬íŠ¸]</strong>
1ìœ„ë¡œ ì„ ì •ëœ <strong>${top.name}</strong>ì€(ëŠ”) ê²½ìŸì‚¬ ëŒ€ë¹„ ê°•ë ¥í•œ ê°€ê²© ë©”ë¦¬íŠ¸ë¥¼ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.

â€¢ <b>ìˆ˜ìµì„± ë° ë°¸ë¥˜</b>: ì˜ì—…ì´ìµë¥  ${top.opM}%ì˜ ê³ ì„±ì¥ì„ ê¸°ë¡í•˜ë©´ì„œë„ PER ${top.curPer}ë°° ìˆ˜ì¤€ìœ¼ë¡œ ê±°ë˜ë˜ì–´ ë°¸ë¥˜ì—ì´ì…˜ ë§¤ë ¥ì´ ì••ë„ì ì…ë‹ˆë‹¤.
â€¢ <b>ê¸°ìˆ ì  ì—ë„ˆì§€</b>: ë§¤ì§‘ë´‰ ${top.candles}ê°œë¥¼ í†µí•´ í•˜ë°© ê²½ì§ì„±ì„ í™•ë³´í–ˆìœ¼ë©°, ìˆ˜ê¸‰ ì£¼ì²´ì˜ ì§„ì…ì´ ê°€ê²© ë°´ë“œ í•˜ë‹¨ì—ì„œ ì´ë£¨ì–´ì§„ ì ì´ ê³ ë¬´ì ì…ë‹ˆë‹¤.
â€¢ <b>ì¢…í•© ê²°ë¡ </b>: ì¬ë¬´ ì•ˆì •ì„±ê³¼ ë‚®ì€ ë©€í‹°í”Œ, ê·¸ë¦¬ê³  ê³µì‹œ ëª¨ë©˜í…€ì„ ë™ì‹œì— ê°–ì¶˜ ê°€ì¥ 'ìš°ì›”í•œ' ì¢…ëª©ìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.
                </div>
            </div>
            <table>
                <thead><tr><th>ìˆœìœ„</th><th>ì¢…ëª©ëª…</th><th>ì¢…í•©ì ìˆ˜</th><th>ì´ìµë¥ </th><th>PER</th><th>ë§¤ì§‘ë´‰</th></tr></thead>
                <tbody>${stockScores.map((s, i) => `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.score.toFixed(1)}</td><td>${s.opM}%</td><td>${s.curPer}</td><td>${s.candles}</td></tr>`).join('')}</tbody>
            </table>`;
        
        document.getElementById('panels').style.display = 'none';
        document.getElementById('report-section').style.display = 'block';
        document.getElementById('report-content').innerHTML = html;
    }

    function closeReport() { document.getElementById('report-section').style.display = 'none'; document.getElementById('panels').style.display = 'block'; }
    function updateTabName(id, val) { const btn = document.getElementById(`btn_${id}`); if(btn) btn.innerText = val || `ì¢…ëª©`; }
    function deleteStock(id) { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { document.getElementById(`btn_${id}`).remove(); document.getElementById(id).remove(); } }
    function manualSave() { alert("ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (V28 ë°¸ë¥˜ì—ì´ì…˜ ê°•í™” ë²„ì „)"); }

    window.onload = () => {
        addNewStock("ì¢…ëª© 1");
        addNewStock("ì¢…ëª© 2");
        openTab(null, "stock_1");
    };
</script>
</body>
</html>
